-- =====================================================
-- V1__create_tables.sql
-- =====================================================

-- Tabela de Usu√°rios (j√° existe, mantendo)
CREATE TABLE usuario
(
    id       BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nome     VARCHAR(255),
    telefone VARCHAR(255),
    email    VARCHAR(255),
    role     VARCHAR(255),
    password VARCHAR(255),
    CONSTRAINT pk_usuario PRIMARY KEY (id)
);

-- Tabela de Perfil (j√° existe, mantendo)
CREATE TABLE perfil
(
    id       BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nome     VARCHAR(255),
    telefone VARCHAR(255),
    email    VARCHAR(255),
    CONSTRAINT pk_perfil PRIMARY KEY (id)
);

-- Tabela de Categorias
CREATE TABLE categorias
(
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    nome          VARCHAR(100)                            NOT NULL,
    descricao     VARCHAR(500),
    cor           VARCHAR(50)                             NOT NULL,
    icone         VARCHAR(50),
    ativa         BOOLEAN                                 NOT NULL,
    padrao        BOOLEAN                                 NOT NULL,
    ordem         INTEGER                                 NOT NULL,
    usuario_id    BIGINT,
    criado_em     TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    atualizado_em TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    CONSTRAINT pk_categorias PRIMARY KEY (id)
);

-- Tabela de Pictogramas
CREATE TABLE pictogramas
(
    id                BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    label             VARCHAR(100)                            NOT NULL,
    label_alternativo VARCHAR(200),
    cor               VARCHAR(50)                             NOT NULL,
    icone             VARCHAR(100),
    imagem_url        VARCHAR(1000),
    tipo              VARCHAR(20)                             NOT NULL,
    ativo             BOOLEAN                                 NOT NULL,
    padrao            BOOLEAN                                 NOT NULL,
    ordem             INTEGER                                 NOT NULL,
    vezes_usado       INTEGER                                 NOT NULL,
    categoria_id      BIGINT                                  NOT NULL,
    usuario_id        BIGINT,
    criado_em         TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    atualizado_em     TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    CONSTRAINT pk_pictogramas PRIMARY KEY (id)
);

-- Tabela de Mensagens (FALTAVA ESTA!)
CREATE TABLE mensagens
(
    id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    conteudo_json      TEXT                                    NOT NULL,
    texto_completo     TEXT                                    NOT NULL,
    contexto           VARCHAR(500),
    usuario_id         BIGINT                                  NOT NULL,
    criado_em          TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    favorita           BOOLEAN                                 NOT NULL,
    vezes_reutilizada  INTEGER                                 NOT NULL,
    dispositivo_origem VARCHAR(50),
    CONSTRAINT pk_mensagens PRIMARY KEY (id)
);

-- Tabela de Frases Favoritas
CREATE TABLE frases_favoritas
(
    id             BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    titulo         VARCHAR(200)                            NOT NULL,
    conteudo_json  TEXT                                    NOT NULL,
    texto_completo TEXT                                    NOT NULL,
    ativa          BOOLEAN                                 NOT NULL,
    ordem          INTEGER                                 NOT NULL,
    vezes_usada    INTEGER                                 NOT NULL,
    usuario_id     BIGINT                                  NOT NULL,
    criado_em      TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    atualizado_em  TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    CONSTRAINT pk_frases_favoritas PRIMARY KEY (id)
);

-- Tabela de Configura√ß√µes de Usu√°rio
CREATE TABLE configuracoes_usuario
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    usuario_id          BIGINT                                  NOT NULL,
    tamanho_pictograma  VARCHAR(20)                             NOT NULL,
    modo_alto_contraste BOOLEAN                                 NOT NULL,
    modo_escuro         BOOLEAN                                 NOT NULL,
    habilitar_som       BOOLEAN                                 NOT NULL,
    velocidade_voz      INTEGER                                 NOT NULL,
    idioma_voz          VARCHAR(10),
    modo_varredura      BOOLEAN                                 NOT NULL,
    tempo_varredura     INTEGER                                 NOT NULL,
    confirmar_selecao   BOOLEAN                                 NOT NULL,
    salvar_historico    BOOLEAN                                 NOT NULL,
    permitir_relatorios BOOLEAN                                 NOT NULL,
    atualizado_em       TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    CONSTRAINT pk_configuracoes_usuario PRIMARY KEY (id)
);

-- =====================================================
-- CONSTRAINTS E √çNDICES
-- =====================================================

-- Unique constraints
ALTER TABLE configuracoes_usuario
    ADD CONSTRAINT uc_configuracoes_usuario_usuario UNIQUE (usuario_id);

-- Foreign Keys
ALTER TABLE categorias
    ADD CONSTRAINT FK_CATEGORIAS_ON_USUARIO FOREIGN KEY (usuario_id) REFERENCES usuario (id);

ALTER TABLE pictogramas
    ADD CONSTRAINT FK_PICTOGRAMAS_ON_CATEGORIA FOREIGN KEY (categoria_id) REFERENCES categorias (id);

ALTER TABLE pictogramas
    ADD CONSTRAINT FK_PICTOGRAMAS_ON_USUARIO FOREIGN KEY (usuario_id) REFERENCES usuario (id);

ALTER TABLE mensagens
    ADD CONSTRAINT FK_MENSAGENS_ON_USUARIO FOREIGN KEY (usuario_id) REFERENCES usuario (id);

ALTER TABLE frases_favoritas
    ADD CONSTRAINT FK_FRASES_FAVORITAS_ON_USUARIO FOREIGN KEY (usuario_id) REFERENCES usuario (id);

ALTER TABLE configuracoes_usuario
    ADD CONSTRAINT FK_CONFIGURACOES_USUARIO_ON_USUARIO FOREIGN KEY (usuario_id) REFERENCES usuario (id);

-- √çndices para performance
CREATE INDEX idx_categoria_usuario ON categorias (usuario_id);
CREATE INDEX idx_categoria_ativa ON categorias (ativa);

CREATE INDEX idx_pictograma_categoria ON pictogramas (categoria_id);
CREATE INDEX idx_pictograma_usuario ON pictogramas (usuario_id);
CREATE INDEX idx_pictograma_ativo ON pictogramas (ativo);

CREATE INDEX idx_mensagem_usuario ON mensagens (usuario_id);
CREATE INDEX idx_mensagem_favorita ON mensagens (favorita);
CREATE INDEX idx_mensagem_data ON mensagens (criado_em);

CREATE INDEX idx_frase_usuario ON frases_favoritas (usuario_id);
CREATE INDEX idx_frase_ativa ON frases_favoritas (ativa);

-- =====================================================
-- V2__insert_default_data.sql
-- Script para popular categorias e pictogramas padr√£o
-- =====================================================

-- Inserir Categorias Padr√£o do Sistema
INSERT INTO categorias (nome, descricao, cor, icone, ativa, padrao, ordem, usuario_id, criado_em, atualizado_em)
VALUES
    ('Emo√ß√µes', 'Express√µes de sentimentos e emo√ß√µes', 'bg-pink-500', 'Heart', true, true, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Alimenta√ß√£o', 'Alimentos e bebidas', 'bg-orange-500', 'Utensils', true, true, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Lugares', 'Locais e ambientes', 'bg-blue-500', 'Home', true, true, 3, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Pessoas', 'Fam√≠lia e relacionamentos', 'bg-purple-500', 'User', true, true, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Necessidades', 'Necessidades b√°sicas', 'bg-red-500', 'AlertCircle', true, true, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('A√ß√µes', 'Verbos e a√ß√µes', 'bg-green-500', 'ThumbsUp', true, true, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Inserir Pictogramas Padr√£o - EMO√á√ïES (categoria_id = 1)
INSERT INTO pictogramas (label, label_alternativo, cor, icone, imagem_url, tipo, ativo, padrao, ordem, vezes_usado, categoria_id, usuario_id, criado_em, atualizado_em)
VALUES
    ('Feliz', 'alegre,contente', 'bg-yellow-400', 'Smile', NULL, 'ICONE', true, true, 1, 0, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Triste', 'chorando,melanc√≥lico', 'bg-blue-400', 'Frown', NULL, 'ICONE', true, true, 2, 0, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Com Raiva', 'bravo,irritado', 'bg-red-500', 'Angry', NULL, 'EMOJI', true, true, 3, 0, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Com Medo', 'assustado,amedrontado', 'bg-gray-600', 'AlertCircle', NULL, 'ICONE', true, true, 4, 0, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Amor', 'carinho,afeto', 'bg-red-400', 'Heart', NULL, 'ICONE', true, true, 5, 0, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Surpreso', 'espantado', 'bg-purple-400', 'üò≤', NULL, 'EMOJI', true, true, 6, 0, 1, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Inserir Pictogramas Padr√£o - ALIMENTA√á√ÉO (categoria_id = 2)
INSERT INTO pictogramas (label, label_alternativo, cor, icone, imagem_url, tipo, ativo, padrao, ordem, vezes_usado, categoria_id, usuario_id, criado_em, atualizado_em)
VALUES
    ('√Ågua', 'beber √°gua', 'bg-cyan-300', 'üíß', NULL, 'EMOJI', true, true, 1, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Leite', 'leitinho', 'bg-blue-200', 'ü•õ', NULL, 'EMOJI', true, true, 2, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Fruta', 'ma√ß√£,banana', 'bg-red-300', 'üçé', NULL, 'EMOJI', true, true, 3, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('P√£o', 'p√£ozinho', 'bg-yellow-300', 'üçû', NULL, 'EMOJI', true, true, 4, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Suco', 'suco de fruta', 'bg-orange-300', 'üßÉ', NULL, 'EMOJI', true, true, 5, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Comida', 'almo√ßo,jantar,refei√ß√£o', 'bg-orange-400', 'üçΩÔ∏è', NULL, 'EMOJI', true, true, 6, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Chocolate', 'doce', 'bg-brown-400', 'üç´', NULL, 'EMOJI', true, true, 7, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Biscoito', 'bolacha', 'bg-yellow-400', 'üç™', NULL, 'EMOJI', true, true, 8, 0, 2, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Inserir Pictogramas Padr√£o - LUGARES (categoria_id = 3)
INSERT INTO pictogramas (label, label_alternativo, cor, icone, imagem_url, tipo, ativo, padrao, ordem, vezes_usado, categoria_id, usuario_id, criado_em, atualizado_em)
VALUES
    ('Casa', 'lar,resid√™ncia', 'bg-blue-400', 'Home', NULL, 'ICONE', true, true, 1, 0, 3, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Escola', 'col√©gio', 'bg-green-400', 'üè´', NULL, 'EMOJI', true, true, 2, 0, 3, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Hospital', 'm√©dico,cl√≠nica', 'bg-red-400', 'üè•', NULL, 'EMOJI', true, true, 3, 0, 3, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Parque', 'pra√ßa', 'bg-green-500', 'üèûÔ∏è', NULL, 'EMOJI', true, true, 4, 0, 3, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Quarto', 'dormir', 'bg-purple-400', 'üõèÔ∏è', NULL, 'EMOJI', true, true, 5, 0, 3, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Inserir Pictogramas Padr√£o - PESSOAS (categoria_id = 4)
INSERT INTO pictogramas (label, label_alternativo, cor, icone, imagem_url, tipo, ativo, padrao, ordem, vezes_usado, categoria_id, usuario_id, criado_em, atualizado_em)
VALUES
    ('Mam√£e', 'm√£e,m√£ezinha', 'bg-pink-400', 'üë©', NULL, 'EMOJI', true, true, 1, 0, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Papai', 'pai,paizinho', 'bg-blue-400', 'üë®', NULL, 'EMOJI', true, true, 2, 0, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Irm√£o', 'irm√£', 'bg-green-400', 'üë¶', NULL, 'EMOJI', true, true, 3, 0, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Vov√≥', 'av√≥,vovozinha', 'bg-purple-400', 'üëµ', NULL, 'EMOJI', true, true, 4, 0, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Vov√¥', 'av√¥,vovozinho', 'bg-gray-400', 'üë¥', NULL, 'EMOJI', true, true, 5, 0, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Amigo', 'colega', 'bg-yellow-400', 'üßë', NULL, 'EMOJI', true, true, 6, 0, 4, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Inserir Pictogramas Padr√£o - NECESSIDADES (categoria_id = 5)
INSERT INTO pictogramas (label, label_alternativo, cor, icone, imagem_url, tipo, ativo, padrao, ordem, vezes_usado, categoria_id, usuario_id, criado_em, atualizado_em)
VALUES
    ('Banheiro', 'toalete,xixi,coc√¥', 'bg-blue-400', 'üöΩ', NULL, 'EMOJI', true, true, 1, 0, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Dormir', 'sono,cansado', 'bg-purple-400', 'üò¥', NULL, 'EMOJI', true, true, 2, 0, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Dor', 'machucado,doendo', 'bg-red-400', 'ü§ï', NULL, 'EMOJI', true, true, 3, 0, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Ajuda', 'socorro,aux√≠lio', 'bg-orange-400', 'üÜò', NULL, 'EMOJI', true, true, 4, 0, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Rem√©dio', 'medicamento', 'bg-green-400', 'üíä', NULL, 'EMOJI', true, true, 5, 0, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Banho', 'tomar banho', 'bg-cyan-400', 'üöø', NULL, 'EMOJI', true, true, 6, 0, 5, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);

-- Inserir Pictogramas Padr√£o - A√á√ïES (categoria_id = 6)
INSERT INTO pictogramas (label, label_alternativo, cor, icone, imagem_url, tipo, ativo, padrao, ordem, vezes_usado, categoria_id, usuario_id, criado_em, atualizado_em)
VALUES
    ('Quero', 'desejo,preciso', 'bg-green-400', 'ThumbsUp', NULL, 'ICONE', true, true, 1, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('N√£o Quero', 'n√£o desejo,recusar', 'bg-red-400', 'ThumbsDown', NULL, 'ICONE', true, true, 2, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Brincar', 'jogar', 'bg-yellow-400', 'üéÆ', NULL, 'EMOJI', true, true, 3, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Ver TV', 'assistir televis√£o', 'bg-blue-400', 'üì∫', NULL, 'EMOJI', true, true, 4, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Ouvir M√∫sica', 'escutar m√∫sica', 'bg-purple-400', 'üéµ', NULL, 'EMOJI', true, true, 5, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Ler', 'livro', 'bg-orange-400', 'üìñ', NULL, 'EMOJI', true, true, 6, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Desenhar', 'pintar', 'bg-pink-400', 'üé®', NULL, 'EMOJI', true, true, 7, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
    ('Sair', 'passear', 'bg-green-500', 'üö∂', NULL, 'EMOJI', true, true, 8, 0, 6, NULL, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);